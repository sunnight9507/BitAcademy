#### 빅데이터 탐색 환경 구성(Hive, Oozie, Hue, Spark) 
#### Hive 설치중 error 났을 때

[root@lx01 usr]# cd /var/lib/cloudera-scm-server-db/data/
[root@lx01 data]# cat generated_password.txt 
rH6rjH1K3i

The password above was generated by /usr/share/cmf/bin/initialize_embedded_db.sh (part of the cloudera-manager-server-db package)
and is the password for the user 'cloudera-scm' for the database in the current directory.

Generated at 20191206-135016.

[root@lx01 data]# psql -p 7432 -U  cloudera-scm -d postgres
cloudera-scm 사용자의 암호: 
psql (8.4.20)
도움말을 보려면 "help"를 입력하십시오.

postgres=# \l
                                        데이터베이스 목록
   이름    |    소유주    | 인코딩 | 데이터 정렬 |   Ctype    |            액세스 권한            
-----------+--------------+--------+-------------+------------+-----------------------------------
 amon      | amon         | UTF8   | en_US.UTF8  | en_US.UTF8 | 
 nav       | nav          | UTF8   | en_US.UTF8  | en_US.UTF8 | 
 navms     | navms        | UTF8   | en_US.UTF8  | en_US.UTF8 | 
 postgres  | cloudera-scm | UTF8   | en_US.UTF8  | en_US.UTF8 | 
 rman      | rman         | UTF8   | en_US.UTF8  | en_US.UTF8 | 
 scm       | scm          | UTF8   | en_US.UTF8  | en_US.UTF8 | 
 template0 | cloudera-scm | UTF8   | en_US.UTF8  | en_US.UTF8 | =c/"cloudera-scm"
                                                              : "cloudera-scm"=CTc/"cloudera-scm"
 template1 | cloudera-scm | UTF8   | en_US.UTF8  | en_US.UTF8 | =c/"cloudera-scm"
                                                              : "cloudera-scm"=CTc/"cloudera-scm"
(8개 행)

postgres=# \du
             롤 목록
   롤 이름    |   속성    | 멤버: 
--------------+-----------+-------
 amon         |           | {}
 cloudera-scm | superuser | {}
              : 롤 만들기   
              : DB 만들기   
 nav          |           | {}
 navms        |           | {}
 rman         |           | {}
 scm          |           | {}

postgres=# CREATE USER hive WITH SUPERUSER PASSWORD 'hive';
CREATE ROLE
postgres=# CREATE DATABASE hive;
CREATE DATABASE

postgres=# \du
             롤 목록
   롤 이름    |   속성    | 멤버: 
--------------+-----------+-------
 amon         |           | {}
 cloudera-scm | superuser | {}
              : 롤 만들기   
              : DB 만들기   
 hive         | superuser | {}
 nav          |           | {}
 navms        |           | {}
 rman         |           | {}
 scm          |           | {}

postgres=# CREATE USER oozie WITH SUPERUSER PASSWORD 'oozie';
CREATE ROLE
postgres=# 
postgres=# 
postgres=# CREATE DATABASE oozie;
CREATE DATABASE
postgres=# \su
잘못된 명령: \su. 도움말은 \?.
postgres=# \du
             롤 목록
   롤 이름    |   속성    | 멤버: 
--------------+-----------+-------
 amon         |           | {}
 cloudera-scm | superuser | {}
              : 롤 만들기   
              : DB 만들기   
 hive         | superuser | {}
 nav          |           | {}
 navms        |           | {}
 oozie        | superuser | {}
 rman         |           | {}
 scm          |           | {}

postgres=# CREATE USER hue WITH SUPERUSER PASSWORD 'hue';
CREATE ROLE
postgres=# CREATE DATABASE hue;
CREATE DATABASE


## Hue를 이용한 데이터 탐색
http://lx02.bigdata2019.com:8888/

# table 생성
create external table if not exists smartcar_status (
reg_date string,
car_number string,
tire_fl string,
tire_fr string,
tire_bl string,
tire_br string,
light_fl string,
light_fr string,
light_bl string,
light_br string,
engine string,
break string,
battery string
)
partitioned by( workdate string )
row format delimited
fields terminated by ','
stored as textfile
location '/smartcar/collection/status/'

# Parition
ALTER TABLE smartcar_status ADD PARTITION(workdate='20191212');

select * 
  from smartcar_status
  limit 5;


# smartcar_master table 생성
CREATE EXTERNAL TABLE smartcar_master (
car_number string,
sex string,
age string,
marriage string,
region string,
job string,
car_capacity string,
car_year string,
car_model string
)
row format delimited
fields terminated by '|'
stored as textfile
location '/smartcar/collection/car_master'


# smartcar_item_buylist table 생성
CREATE EXTERNAL TABLE smartcar_item_buylist (
car_number string,
Item string,
score string,
month string
)
row format delimited
fields terminated by ','
stored as textfile
location '/smartcar/collection/buy_list'


# spark 접속
[datamaster@lx02 ~]$ spark-shell
Setting default log level to "WARN".
To adjust logging level use sc.setLogLevel(newLevel).
Welcome to
      ____              __
     / __/__  ___ _____/ /__
    _\ \/ _ \/ _ `/ __/  '_/
   /___/ .__/\_,_/_/ /_/\_\   version 1.6.0
      /_/

Using Scala version 2.10.5 (Java HotSpot(TM) 64-Bit Server VM, Java 1.8.0_231)
Type in expressions to have them evaluated.
Type :help for more information.
Spark context available as sc (master = yarn-client, app id = application_1576471863813_0001).
SQL context available as sqlContext.

scala> val smartcar_master_df = sqlContext.sql("SELECT * from smartcar_master where age >=18");
smartcar_master_df: org.apache.spark.sql.DataFrame = [car_number: string, sex: string, age: string, marriage: string, region: string, job: string, car_capacity: string, car_year: string, car_model: string]
